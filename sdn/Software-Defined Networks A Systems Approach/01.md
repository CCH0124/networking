### SDN 概論：一種加速創新的系統性方法

首先，我們必須理解 SDN 並非一個單點解決方案，而是一種**建構網路的方法論 (approach)**。它的核心目標不是直接解決路由、壅塞控制或安全等特定技術挑戰，而是透過改變網路的實作方式，為解決這些問題的**創新方案提供可能性與更快的迭代速度**。

本書採用**系統性的視角 (systems lens)** 來探討 SDN，強調其背後的一系列設計原則，並將一個基於 SDN 的網路視為一個運行在商用硬體上、可水平擴展的分散式系統。這種觀點打破了傳統網路教科書以 OSI 七層或 TCP/IP 三層協定堆疊為主的框架，改為圍繞一個全新的**軟體堆疊 (software stack)** 來組織內容。

SDN 的起源，可以追溯到電腦科學研究社群為了解決網際網路「僵化 (ossification)」問題所做的努力。其中，史丹佛大學教授 Scott Shenker 提出的核心論點——網路領域迫切需要**引入更高層次的抽象化 (abstractions)** 來管理其複雜性——是理解本書後續所有系統、平台與介面的關鍵。

### 1.1 市場格局：從垂直整合到水平生態系

要理解 SDN 的深遠影響，必須先從市場格局的轉變談起。SDN 的概念深受數十年前運算產業轉型的啟發。

*   **過去的運算產業**：是一個**垂直市場 (vertical market)**。客戶從單一供應商（如 IBM）購買包含硬體、作業系統到應用程式的完整解決方案。
*   **現在的運算產業**：在微處理器（如 Intel x86）和開源作業系統（如 Linux）的推動下，轉變為一個**水平市場 (horizontal marketplace)**。開放的介面在各個層級催生了大量的創新與選擇。

SDN 的目標，正是在網路產業複製這場變革。傳統網路設備商提供的是軟硬體綁定的封閉專有設備，形成了一個垂直整合的市場。SDN 試圖打破這個僵局，催生一個如 **圖 2** 所示的水平生態系：
*   **底層**：基於商用矽晶片 (merchant silicon) 的**白牌交換器 (bare-metal switches)** 成為商品化的硬體基礎。
*   **中層**：多家廠商可以在這些白牌硬體上提供不同的**網路作業系統 (Network Operating Systems)**。
*   **上層**：豐富的**網路應用程式 (networking applications)** 市場得以蓬勃發展。

![](https://sdn.systemsapproach.org/_images/Slide02.png)

這場變革的價值在於，它將網路的**控制權從設備供應商轉移到網路營運商**手中，從而為創新釋放了前所未有的機會。


### 1.2 技術格局：SDN 的三大核心設計原則

本節深入探討 SDN 的核心技術原則。值得注意的是，本書主要闡述的是最徹底的「**純粹 SDN (pure play SDN)**」實現，以展現其最大潛力，而非那些為了簡化導入而由現有廠商推出的「輕量版 SDN (SDN-lite)」混合方案。

#### 1.2.1 控制與資料平面的解耦 (Disaggregation)

這是 SDN 最根本、最開創性的思想。

*   **定義**：
    *   **控制平面 (Control Plane)**：決定網路應如何運作，例如透過執行 BGP、OSPF 等路由協定來計算路徑。它維護著**路由資訊庫 (Routing Information Base, RIB)**。
    *   **資料平面 (Data Plane)**：負責在單一封包層級上實踐控制平面的決策，例如根據轉送表將封包從輸入埠轉送到輸出埠。它維護著**轉送資訊庫 (Forwarding Information Base, FIB)**。
*   **SDN 的第一原則**：控制平面與資料平面之間的介面必須是**定義良好且開放的**。這種徹底的模組化被稱為**解耦 (disaggregation)**，它允許不同廠商分別提供控制平面與資料平面的產品。
*   **核心抽象化**：為了實現解耦，需要一個通用的**轉送抽象化 (forwarding abstraction)**。早期最具影響力的實作是 **OpenFlow**，它引入了「**流規則 (Flow Rules)**」的概念。
    *   **流規則**：一個「**匹配-動作 (Match-Action)**」的配對。例如，一個規則可以指定「所有目的地位址為 D 的封包，都從埠 i 送出」。控制器 (Controller) 透過一個安全的協定將這些規則下發到交換器的**流表 (Flow Table)** 中。
*   **控制 vs. 組態**：一個重要的區別是**控制 (Control)** 與**組態 (Configuration)**。控制是即時的，要求在毫秒甚至亞毫秒內對網路事件（如鏈路中斷）做出反應。而組態則是用於修改控制平面的設定（如 RIB 條目），更新頻率遠低於控制（例如每天數千次 vs. 每秒數千次）。僅僅提供一個程式化的組態介面，並不能算是真正的 SDN。


![Control plane (and corresponding RIB) decoupled from the data plane (and the corresponding FIB).](https://sdn.systemsapproach.org/_images/Slide24.png)

##### 轉送抽象化：OpenFlow 的開創性實踐

要實現解耦，就必須有一個通用的**轉送抽象化 (forwarding abstraction)**，讓控制平面能夠以一種標準化的方式，指示資料平面如何轉送封包，而不必關心底層硬體的具體實作細節。

*   **Flow Rules (流規則)**：在 SDN 發展初期，最具影響力的介面 **OpenFlow** 引入了「流規則」這個簡單卻強大的抽象概念。一個流規則本質上就是一個「**匹配-動作 (Match-Action)**」的配對。
    *   **匹配 (Match)**：定義了一組條件，用來識別特定流量。例如，原始的 OpenFlow 規範允許匹配 **圖 4** 所示的多個標頭欄位，像是「MAC 標頭的 `Type` 欄位值為 `0x800`（代表 IP 封包）」且「IP 標頭的 `DstAddr` 欄位屬於 `192.12.69/24` 網段」。
    ![Header Fields Matched in Original OpenFlow Specification.](https://sdn.systemsapproach.org/_images/Slide03.png) 圖 4
    *   **動作 (Action)**：定義了當封包符合匹配條件時，交換器應執行的操作。最初的動作包含「將封包轉送到一個或多個埠」、「丟棄封包」，以及一個重要的「將封包送往控制平面」的選項，用於處理需要控制器進一步分析的封包。

*   **運作模型**：控制器 (Controller) 透過一個安全的協定，將這些流規則下發到交換器中一個稱為**流表 (Flow Table)** 的資料結構裡。這種架構使得控制器可以運行在**交換器之外 (off-switch)**，實現了物理上的分離，如 **圖 5** 所示。

![Controller securely passes flow rules to an OpenFlow-enabled switch, which maintains a Flow Table.](https://sdn.systemsapproach.org/_images/Slide04.png) 圖 5


雖然 OpenFlow 對於啟動 SDN 的發展至關重要，但將 SDN 與 OpenFlow 劃上等號會嚴重低估 SDN 的價值。如今，OpenFlow 自身已經歷了多次修訂，且業界正在朝向更具彈性的可程式化替代方案（如 P4）發展。

#### 1.2.2 控制平面：集中式 vs. 分散式

在解耦之後，下一個問題是如何實現控制平面。

*   **傳統方式（分散式）**：控制平面軟體運行在**每台交換器上 (on-switch)**，各交換器自主運行 BGP、OSPF 等協定，相互溝通以建立各自的路由表。這種方式雖然降低了成本，但營運商仍受限於緩慢的協定標準化流程，難以快速創新。
*   **SDN 的第二原則（集中式）**：控制平面應與資料平面完全獨立，並且是**邏輯上集中的 (logically centralized)**。這意味著控制平面運行在**交換器之外 (off-switch)**，例如在雲端的控制器中。
    *   **邏輯集中**：這不代表只有一台伺服器。為了可擴展性 (scalability) 和可用性 (availability)，控制器的實作可以分散在多台伺服器上，但對外提供一個全域的網路狀態視圖。
    *   **網路作業系統 (NOS)**：這個概念應運而生。NOS 就像伺服器的作業系統，它抽象化底層交換器的細節，為上層的**控制應用程式 (Control Apps)** 提供一個**網路地圖 (Network Map)** 的抽象視圖。
    *   **優勢**：集中化使得計算**全域最佳化解 (globally optimized solutions)** 成為可能，這是傳統分散式網路無法做到的。同時，它也提供了一個統一的 API 入口點，極大地促進了網路自動化與虛擬化等應用。

![Network Operating System (NOS) hosting a set of control applications and providing a logically centralized point of control for an underlying network data plane.](https://sdn.systemsapproach.org/_images/Slide05.png)

#### 1.2.3 資料平面：可程式化 vs. 固定功能

最後一個設計維度是資料平面的實作方式。

*   **背景**：高效能交換器採用硬體式的**轉送管線 (forwarding pipeline)** 來處理封包。
*   **設計選擇**：
    *   **固定功能管線 (fixed-function pipelines)**：只能匹配一組固定的封包標頭欄位（如 **圖 4** 所示），並執行固定的動作。
    *   **可程式化管線 (programmable pipelines)**：匹配的欄位和執行的動作都可以被動態地程式化。
*   **為何需要可程式化？**
    1.  **效能問題**：為了高效能，交換器使用 TCAM 等特殊記憶體，其容量有限。控制器需要了解管線的細節才能有效安裝規則，這導致控制應用程式與特定硬體綁定。
    2.  **協定演進問題**：網路協定不斷演進。例如，當 VLAN 不足以應付雲端租戶數量時，VXLAN 等新封裝格式出現了。固定功能的硬體管線要支援新協定，需要漫長的硬體改版週期。
*   **解決方案**：**可程式化轉送管線**（如 PISA 架構）與用於編寫管線邏輯的**高階語言**（如 P4）應運而生。這標誌著 SDN 已從最初只關注控制平面的可程式化，演進到包含資料平面的可程式化。


![VXLAN Header encapsulated in a UDP/IP packet.](https://sdn.systemsapproach.org/_images/Slide06.png)


### 1.3 SDN 的定義與願景

綜合以上討論，我們可以對 SDN 給出一個層次化的定義：

*   **初始定義 (Phase 1)**：一個**控制平面與轉送平面實體分離，且單一控制平面控制多個轉送設備的網路**。
*   **擴展定義 (Phase 2)**：在初始定義的基礎上，進一步涵蓋了**具備可程式化轉送管線的交換器**。

我們可以將 SDN 的發展視為兩個階段：
1.  **第一階段**：網路營運商取得了**控制平面的所有權**。
2.  **第二階段**：營運商正在取得**資料平面封包處理方式的控制權**。

其終極願景是將控制權從**供應商 -> 營運商 -> 最終用戶**，實現「**網路將由眾人編寫，而由少數人營運**」的理想。
