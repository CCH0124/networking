本章節的核心在於展示 SDN 如何從資料中心走向網路的最終一哩路 (last mile)，將其革命性的解構 (disaggregation) 與軟體化原則，應用於傳統上由專用、封閉設備主導的光纖到府 (Fiber-to-the-Home) 與行動蜂巢式網路 (Mobile Cellular Network)。

這片領域之所以是 SDN 的沃土，正是因為其傳統架構是由一系列為特定目的打造的設備所構成，對於熟悉 L2/L3 乙太網路交換器架構的網路專家來說，顯得既陌生又複雜。SDN 的價值便在於隱藏甚至消除這些不必要的複雜性，帶來前所未有的創新速度。

### 1. 背景知識：傳統接取網路的架構

要理解 SDN 如何改造接取網路，首先必須了解被其取代的傳統系統。本章節聚焦於兩種關鍵技術：PON 和 RAN，它們分別是光纖到府和行動網路的核心。這些網路都根植於 ISP 網路邊緣的設施，在電信領域稱為**中心機房 (Central Offices)**，在有線電視領域則稱為**頭端 (Head Ends)**。

#### **1.1 被動光纖網路 (Passive Optical Network, PON)**
PON 是一種樹狀結構的光纖網路，從 ISP 的中心機房出發，最終可延伸至多達 1024 個家庭。

*   **核心架構**：
    *   **光線路終端 (OLT, Optical Line Terminal)**：位於 ISP 的中心機房內。
    *   **光網路單元 (ONU, Optical Network Unit)**：位於用戶家中。
    *   **被動分光器 (Passive Splitters)**：其「被動」之名源於此，它們僅在光學層面分發上下行訊號，而不進行任何主動的訊框儲存與轉發。
    *   **寬頻網路閘道器 (BNG, Broadband Network Gateway)**：連接接取網路與網際網路的電信設備，負責用戶認證、區分服務等級及流量計費等功能。

*   **運作原理**：
    *   PON 採用多路存取協定。上下行流量使用不同的光波長，互不干擾。
    *   **下行流量**：從 OLT 發出後，訊號會廣播到所有 ONU。每個 ONU 根據訊框中的唯一識別碼決定保留或丟棄，並透過加密防止竊聽。
    *   **上行流量**：採用分時多工 (Time-Division Multiplexing)，每個 ONU 輪流獲得傳輸時槽。
    *   **頻寬演進**：技術不斷演進，目前廣泛部署的是支援 2.25 Gbps 的 G-PON，而 10 Gbps 的 XGS-PON 也已開始部署。

#### **1.2 無線接取網路 (Radio Access Network, RAN)**
RAN 透過無線電頻譜實現最後一哩的連接。

*   **核心架構**：
    *   **基地台 (Base Stations)**：分佈在特定地理區域，透過回程網路 (backhaul network) 互相連接，並連回中心機房。
    *   **行動核心網 (Mobile Core)**：功能上類似 BNG，是連接 RAN 與網際網路的 IP 閘道，負責認證、QoS、計費，但額外增加了**行動性管理**的職責（如追蹤用戶設備位置、管理基地台間的換手）。

*   **運作原理**：
    *   RAN 實質上是一個疊加在回程網路上、以基地台為節點的區域性封包交換網路。
    *   基地台之間會協同執行一個**分散式決策演算法**，以最有效的方式利用無線頻譜，並據此在彼此間轉發封包。這些決策包括：
        *   **換手 (Handovers)**：將特定用戶的流量交給另一個基地台。
        *   **負載平衡 (Load Balancing)**：根據當前負載決定由哪個基地台服務用戶。
        *   **鏈路聚合 (Link Aggregation)**：多個基地台共同為一個用戶傳輸資料。

![](https://sdn.systemsapproach.org/_images/Slide55.png) A Radio Access Network (RAN) connecting a set of cellular devices (User Equipment—UEs) to a Mobile Core hosted in a Central Office.

#### **1.3 關鍵啟示 (Key Takeaways)**
在應用 SDN 之前，有三個重要的觀察：
1.  **接取網路 vs. IP 閘道**：必須區分「接取網路」（PON/RAN）與「IP 閘道」（BNG/Mobile Core）。SDN 不僅能應用於 PON 和 RAN，也能應用於 BNG 和 Mobile Core，後者本質上是增強型的 IP 路由器，其新功能可透過 P4 程式擴展來實現。
2.  **SDN on PON**：由於 PON 網路本身是被動的，軟體控制的機會僅存在於**端點**（OLT 和 ONU）。因為 ONU 只是被動響應 OLT 的指令，這實際上簡化為**解構 OLT**。
3.  **SDN on RAN**：RAN 是一個由基地台組成的封包交換網路，因此存在軟體控制的機會。這需要**解構基地台**，將其多層協定堆疊的功能「切分」並「分佈」到網路的不同位置。

### 2. 軟體定義 PON (SD-PON)

SD-PON 的機會在於將 OLT 視為配備了不同 MAC 層的特殊 L2 交換器，並將其解構成可由軟體控制的裸機硬體。然而，實現 SD-PON 面臨三大挑戰：OLT 需要大量設定、ONU 是受 OLT 間接控制的有限設備、以及營運商必須處理現存的傳統設備。

為此，業界發展出了如圖 53 所示的 SD-PON 架構（在 ONF 的開源專案中稱為 SEBA）。

*   **VOLTHA (虛擬 OLT 硬體抽象層)**：
    *   這是位於網路作業系統 (ONOS) 和 OLT 之間的硬體抽象層。
    *   VOLTHA 向北提供一個 OpenFlow 介面，讓 ONOS 能像控制任何 SDN 設備一樣控制 OLT。其內部則透過廠商特定的適配器 (adaptors) 將 OpenFlow 指令翻譯成各 OLT 的專有指令。
    *   這種設計旨在讓 VOLTHA 保持與網路作業系統無關 (Network OS agnostic)。

*   **將網路模型化為交換器 (Network-Modeled-as-a-Switch)**：
    *   這是架構中最巧妙的設計。由於 ONU 無法被直接控制，SD-PON 將一個 OLT 及其連接的所有 ONU **抽象為一個邏輯交換器**。
    *   該邏輯交換器有面向網路的埠 (NNI) 和面向用戶的埠 (UNI)。當用戶家中的 ONU 開機時，ONOS 會觀測到對應 UNI 埠的一個「port active」事件，並觸發後續的控制應用程式。

*   **用戶上線流程**：
    1.  ONU 上線，觸發邏輯交換器的埠啟用事件。
    2.  啟動 802.1X 認證程序，驗證 ONU 屬於已知客戶。
    3.  認證成功後，SD-PON 應用程式指示 ONOS 在交換矩陣中建立一條符合 QoS 規範的路徑。
    4.  家中的路由器發送 DHCP 請求，觸發 IP 位址分配，並讓 ONOS 建立一條連接該路由器到上游 BNG 的路由，從而接入網際網路。

![](https://sdn.systemsapproach.org/_images/Slide61.png) Software-Defined PON architecture.

### 3. 軟體定義 RAN (SD-RAN)

5G 的真正潛力不僅是頻寬提升，更是從單一的寬頻連接服務轉變為支持 AR/VR、自動駕駛、物聯網等豐富的邊緣服務。要實現這一願景，必須將 SDN 原則應用於 RAN，以提升功能演進速度 (feature velocity)。

*   **核心理念**：將基地台視為專用的封包交換器，並將其分散式的本地決策轉變為**全域優化問題**。
    *   每個基地台向一個中央 SDN 控制器（即 RIC）回報本地收集的無線傳輸品質統計數據。
    *   控制器綜合來自多個基地台的資訊，建構出無線頻譜利用的全域視圖。
    *   一系列控制應用程式 (xApps) 基於此全域視圖做出最佳決策（如換手、鏈路聚合等），並將控制指令推送回基地台。
    *   這是一個**近乎即時 (near real-time)** 的控制迴路，時間尺度在 10 毫秒以內。

#### **3.1 切分式 RAN**
為了實現軟體控制，首先需要將基地台的處理管線進行切分。

*   **RAN 處理管線**：包含 RRC（無線資源控制）、PDCP、RLC、MAC、PHY 等階段。RRC 屬於控制平面，負責策略配置；而 MAC 層的排程器則負責即時的傳輸決策。
*   **O-RAN 定義的切分**：業界（由 O-RAN 聯盟主導）正積極推動如圖 55 所示的切分方案。
    *   **無線電單元 (RU, Radio Unit)**：靠近天線。
    *   **分散式單元 (DU, Distributed Unit)**：負責即時功能（如 MAC 排程器），需要與 RU 保持在 1ms 延遲以內。
    *   **中央單元 (CU, Central Unit)**：運行在雲端，負責非即時和近乎即時的功能（如 RRC），一個 CU 可服務多個 DU。

#### **3.2 RAN 智慧控制器 (RAN Intelligent Controller, RIC)**
RRC 作為 RAN 的控制平面，在切分後被集中到 CU 中，這自然地對應到 SDN 的集中式控制模型。O-RAN 聯盟將這個 SDN 控制器稱為 RIC。

*   **ONOS-based RIC**：以 ONOS 為基礎的 RIC 實作（如圖 58）展示了其架構。
    *   它利用了 ONOS 現有的**拓撲服務 (Topology Service)**。
    *   並引入了兩個新的 RAN 專用服務：
        *   **控制服務 (Control Service)**：基於 Atomix 鍵/值存儲，管理所有基地台和用戶設備的控制狀態。
        *   **遙測服務 (Telemetry Service)**：基於**時間序列資料庫 (TSDB)**，追蹤 RAN 元件回報的鏈路品質資訊。
    *   各種**控制應用 (xApps)**，如換手控制、負載平衡等，分析這些數據以做出全域最佳決策。

#### **3.3 RIC 介面**
RIC 的運作依賴於一系列標準化介面：
*   **A1 介面**：供營運商的管理平面（OSS/BSS）配置 RAN，可視為 gNMI/gNOI 的 RAN 對應物。
*   **E2 介面**：供 RIC 控制底層的 RAN 元件（CU, DU, RU），可視為 OpenFlow 的 RAN 對應物。E2 的核心是**服務模型 (Service Model)** 抽象，每個 RAN 元件會宣告其支援的 RAN 功能集，RIC 則可對其發出**回報 (Report)、插入 (Insert)、控制 (Control)、策略 (Policy)** 等操作。
*   **xApp SDK**：ONOS 實作中供 xApps 使用的北向介面，類似於 Flow Objectives。

### 4. SD-Fabric 的角色

本章節最後一部分闡明了接取網路 SDN 與資料中心交換矩陣 SDN 之間的協同作用。接取網路的 IP 閘道（BNG 和 Mobile Core）的資料平面功能，可以由 SD-Fabric 來實現。

*   **PON 場景**：SD-PON 架構中的交換矩陣**就是** SD-Fabric。BNG 的資料平面功能（如 Q-in-Q 標記）是 SD-Fabric 支援的特性之一。同時，SD-Fabric 也連接了運行 BNG 控制平面軟體（以及其他 VNF）的伺服器叢集。

*   **RAN 場景**：5G 行動核心網的資料平面由**用戶平面功能 (UPF, User Plane Function)** 實現。
    *   UPF 的功能可以從伺服器上運行的微服務**卸載 (off-load)** 到可程式化的交換矩陣中執行。這正是 `fabric.p4` 的 `upf` 擴展所實現的功能。
    *   UPF 的主要任務包括：
        1.  GTP 隧道封裝/解封裝（可在 P4 中實現）。
        2.  根據 QoS 等級進行封包佇列（可在 P4 中實現）。
        3.  在用戶換手期間暫存封包（目前 P4 交換器無法支援，需將封包重導向至伺服器或 SmartNIC 處理）。

#### **結論：邁向接取-邊緣雲 (Access-Edge Cloud)**
最終，接取網路與交換矩陣的 SDN 方案可以協同工作，形成一個**接取-邊緣雲**：一個由商用伺服器和交換器組成的小型叢集，部署在企業或其他邊緣站點，能夠同時承載接取網路的工作負載（如 RIC 和 xApps）和邊緣服務的工作負載。開源專案 Aether 就是這樣一個整合了 SD-Fabric, SD-RAN 和 SD-Core 的自足式邊緣雲範例。
